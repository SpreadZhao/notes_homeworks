---
title:
  - LiveData get the recent available data immediately on observation
date: 2025-02-20
tags:
  - livedata
  - bugfix
mtrace:
  - 2025-02-20
---

# LiveData get the recent available data immediately on observation

è¿™ä¸ªä¹Ÿæ˜¯è€ç”Ÿé•¿è°ˆçš„LiveDataæ•°æ®å€’çŒé—®é¢˜ï¼š[LiveData æ•°æ®å€’çŒé—®é¢˜ï¼šæˆ‘ä»¬éœ€è¦çŸ¥é“çš„é‚£äº›äº‹å„¿_livedataæ•°æ®å€’çŒæ€ä¹ˆè§£å†³-CSDNåšå®¢](https://blog.csdn.net/qq_42751010/article/details/141645254)ã€‚

æˆ‘åœ¨ä¸šåŠ¡å¼€å‘ä¸­é‡åˆ°çš„æƒ…å†µæ˜¯è¿™æ ·çš„ï¼šåœ¨å¤–å±‚Feedæµä¸­ï¼Œå…ˆç‚¹ä½œè€…å¤´åƒï¼Œä¼šå±•å¼€ä¸ªäººé¡µæµ®å±‚ã€‚æ­¤æ—¶ä¼šä¸ŠæŠ¥`enter_pgc`åŸ‹ç‚¹ã€‚ç„¶åå…³æ‰è¿™ä¸ªæµ®å±‚ï¼Œè¿›å…¥åˆé›†å†…æµï¼Œç„¶åå†ç‚¹è¿™ä¸ªå¤´åƒï¼Œä¼šå‘ç°ï¼Œè¿™æ¬¡ç‚¹å¼€ä¹‹åä¼š**åŒæ—¶ä¸ŠæŠ¥2ä¸ª`enter_pgc`åŸ‹ç‚¹ï¼è¿™æ˜¾ç„¶æ˜¯ä¸ç¬¦åˆé¢„æœŸçš„ï¼›ç”šè‡³ï¼Œå…¶ä¸­ä¸€ä¸ªåŸ‹ç‚¹è¿˜ç¼ºå°‘äº†logpb**ã€‚

- [x] #TODO tasktodo1739984342379 è¡¥ä¸€ä¸‹å›¾ç‰‡ã€‚ ğŸ†” k0zx4c ğŸ”º â• 2025-02-20 âœ… 2025-04-25

> å›¾ç‰‡å°±ä¸è¡¥äº†ï¼Œè¯´ä¸€ä¸‹æˆ‘æ˜¯æ€ä¹ˆå‘ç°çš„ï¼Œé¦–å…ˆï¼Œä¸¤æ¬¡åŸ‹ç‚¹é€šè¿‡byteioå°±èƒ½çœ‹åˆ°ã€‚è€Œä¸ŠæŠ¥è¿™ä¸ªåŸ‹ç‚¹çš„ä½ç½®æ˜¯ç¡®å®šçš„ï¼Œé‚£debugä¸€ä¸‹å°±è¡Œäº†ã€‚ä¸¤æ¬¡æ–­åœ¨è¿™é‡Œçš„æ—¶å€™ï¼Œå¯¹åº”Viewçš„hashæ˜¯ä¸ä¸€æ ·çš„ã€‚æ‰€ä»¥ä¸€ä¸‹å°±æ„è¯†åˆ°ï¼Œæ˜¯å› ä¸ºä¹‹å‰åœ¨å¤–æµå…ˆç‚¹äº†ä¸ªäººé¡µï¼Œå¯åŠ¨äº†ä¸€ä¸ªViewå¯¼è‡´çš„ã€‚

é¦–å…ˆï¼Œå¤–æµçš„ä¸ªäººé¡µå’Œå†…æµçš„ä¸ªäººé¡µæ˜¯åŒä¸€ä¸ªå®ç°çš„ä¸åŒå®ä¾‹ï¼Œåæ­£æ˜¯ä¸¤ä¸ªä¸€æ ·ç±»å‹çš„Viewã€‚è€Œè¿›å…¥å†…æµä¹‹åï¼Œå¤–æµçš„é‚£ä¸ªä¸ªäººé¡µè™½ç„¶è¢«å…³æ‰äº†ï¼Œä½†æ˜¯æ˜¯æ²¡æœ‰è¢«å›æ”¶çš„ã€‚

åœ¨åˆå§‹åŒ–Viewçš„æ—¶å€™ï¼Œä¼šå…ˆæ³¨å†ŒLiveDataçš„è§‚å¯Ÿï¼Œç„¶åå‘èµ·æŸ¥è¯¢ä¸ªäººé¡µæ•°æ®çš„è¯·æ±‚ã€‚åœ¨è¯·æ±‚æˆåŠŸä¹‹åï¼Œä¼šä¿®æ”¹LiveDataï¼Œè¡¨æ˜æˆåŠŸè¿›å…¥ã€‚åœ¨æˆåŠŸè¿›å…¥çš„å›è°ƒä¸­ä¼šä¸ŠæŠ¥`enter_pgc`åŸ‹ç‚¹ã€‚å‘èµ·è¯·æ±‚ç”¨çš„æ˜¯ViewModelï¼Œ**è¿™æ˜¯è¢«ä¸¤ä¸ªå®ä¾‹æ‰€å…±ç”¨çš„**ã€‚

å› æ­¤ï¼Œåœ¨è¿™ä¸ªbad caseä¸­ï¼Œæ—¶åºå¦‚ä¸‹ï¼š

1. å¤–å±‚Viewå±•å¼€ï¼Œæ³¨å†Œäº†ä¸€ä¸ªobserverï¼Œç„¶åå‘èµ·è¯·æ±‚ï¼Œè¿”å›æˆåŠŸï¼Œä¿®æ”¹LiveDataã€‚æ­¤æ—¶çŠ¶æ€ä¸ºSuccessï¼›
2. å¤–å±‚Viewä¸ŠæŠ¥`enter_pgc`åŸ‹ç‚¹ï¼Œæ­¤æ¬¡ä¸ŠæŠ¥ç¬¦åˆé¢„æœŸã€‚
3. ä¹‹åè¿›å…¥å†…æµï¼Œå†…å±‚Viewå±•å¼€ï¼Œå†æ¬¡æ³¨å†Œäº†ä¸€ä¸ªobserverã€‚æ­¤æ—¶ï¼Œå› ä¸ºLiveDataçš„ç‰¹æ€§ï¼Œæ³¨å†Œçš„æ—¶å€™ä¼šç«‹åˆ»æ”¶åˆ°ä¸€ä¸ªSuccessçŠ¶æ€å¹¶æ‰§è¡Œå›è°ƒã€‚ä¹Ÿä¼šä¸ŠæŠ¥`enter_pgc`ã€‚ä½†æ˜¯ï¼Œè¿™ä¸ªæ—¶å€™åŸ‹ç‚¹å‚æ•°è¿˜æ²¡æœ‰ç»‘å®šä¸Šï¼ˆç»‘å®šçš„æ—¶æœºè¦æ™šäºæ³¨å†Œï¼‰ï¼Œæ‰€ä»¥æ­¤æ¬¡ä¸ŠæŠ¥ä¸¢å¤±äº†logpbä¿¡æ¯ï¼›å¦å¤–ï¼Œè¿™æ¬¡ä¸ŠæŠ¥æœ¬èº«æ˜¯ä¸åº”è¯¥å­˜åœ¨çš„ï¼Œå› ä¸ºç½‘ç»œè¯·æ±‚è¿˜æ²¡å‘å‡ºå»ï¼Œå‡­ä»€ä¹ˆæ‰§è¡Œsuccesså›è°ƒï¼Ÿ
4. ç„¶åï¼Œå†…å±‚Viewä¹Ÿå‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œå†æ¬¡æ”¶åˆ°Successå¹¶æ‰§è¡Œå›è°ƒï¼Œæœ€ååˆä¸ŠæŠ¥äº†ä¸€æ¬¡`enter_pgc`ã€‚æ­¤æ—¶åŸ‹ç‚¹ä¿¡æ¯å·²ç»ç»‘å®šä¸Šï¼Œæ‰€ä»¥æ­¤æ¬¡ä¸ŠæŠ¥ç¬¦åˆé¢„æœŸã€‚

æ€»ç»“ï¼Œè¿™ä¸‰æ¬¡ä¸ŠæŠ¥ä¸­ï¼Œä¸­é—´çš„é‚£æ¬¡æ˜¯ä¸åº”è¯¥å­˜åœ¨çš„ã€‚æ ¹æœ¬åŸå› å°±æ˜¯LiveDataçš„æ•°æ®å€’çŒï¼š

```kotlin
viewModel.userCount.observe(viewLifecycleOwner) {
	Log.i("Study-LiveData", "[o1] user count: $it")
}
getUserBtn.setOnClickListener {
	viewModel.addUser()
}
addObserverBtn.setOnClickListener {
	if (!observerAdded) {
		observerAdded = true
		viewModel.userCount.observe(viewLifecycleOwner) {
			Log.i("Study-LiveData", "[o2] user count: $it")
		}
	}
}
```

æˆ‘ä»¬ç”¨ä»£ç æ¥æ¨¡æ‹Ÿä¸€ä¸‹ã€‚o1æ˜¯ä¸€å¼€å§‹æ³¨å†Œå¥½çš„observerï¼Œå¯¹åº”å¤–æµçš„Viewã€‚o2æ˜¯å†…æµçš„Viewæ³¨å†Œçš„observerï¼Œåœ¨ç‚¹å‡»æŒ‰é’®ä¹‹åæ‰ä¼šæ·»åŠ ã€‚æˆ‘ä»¬é¦–å…ˆæ­£å¸¸ä¸æ–­ç‚¹å‡»getUserBtnï¼Œæ—¥å¿—æ˜¯è¿™æ ·çš„ï¼š

![[Study Log/android_study/android_diary/resources/Pasted image 20250220005448.png]]

ç„¶åæˆ‘ä»¬ç‚¹å‡»ä¸€ä¸‹addObserverBtnã€‚ä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ

![[Study Log/android_study/android_diary/resources/Pasted image 20250220005529.png]]

æˆ‘ä»¬å‘ç°ï¼Œobserveråˆšæ³¨å†Œä¸Šï¼Œå°±ç«‹åˆ»æ”¶åˆ°äº†ä¸€ä¸ªæœ€è¿‘çš„æ›´æ–°6ã€‚å…¶å®ï¼Œè¿™ä¸ªé€»è¾‘åœ¨LiveDataçš„observeæ–¹æ³•çš„æ³¨é‡Šé‡Œéƒ½å·²ç»å†™äº†ï¼š

> When data changes while the owner is not active, it will not receive any updates. <u>If it becomes active again, it will receive the last available data automatically.</u>

è§£å†³æ–¹æ³•å…¶å®å·²ç»æœ‰å¾ˆå¤šäº†ï¼Œå‚è€ƒæ–‡ç« é‡Œçš„è‡ªå®šä¹‰Eventå°±æ˜¯ä¸€ç§ã€‚ä½†æ˜¯ï¼Œå› ä¸ºä¿®æ”¹æ•´ä¸ªåŠ è½½ä¸ªäººé¡µçš„é‚£ä¸ªæˆæœ¬æœ‰ç‚¹é«˜ï¼ˆå…¶å®æ˜¯æˆ‘è¦ä¸‹ç­äº†ï¼Œå¿«ç‚¹ä¿®å®Œå§ã€‚ã€‚ã€‚ï¼‰ï¼Œæ‰€ä»¥æˆ‘æœ€åç”¨çš„æ–¹å¼æ˜¯ï¼Œæ¯æ¬¡observeä¹‹å‰ï¼Œå…ˆremoveæ‰å…¶å®ƒobserverã€‚å…·ä½“å®ç°å°±ä¸è¯´äº†ï¼Œä¸€è¡Œä»£ç ã€‚